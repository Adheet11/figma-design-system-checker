(()=>{"use strict";function e(e){return e.visible}function t(n,o,i){if((!("visible"in n)||e(n))&&("type"in n&&o(n),!(i&&"type"in n&&i(n))&&"children"in n))for(const e of n.children)t(e,o,i)}function n(e){const t=Math.round(255*e.r),n=Math.round(255*e.g),o=Math.round(255*e.b);return`#${t.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}${o.toString(16).padStart(2,"0")}`}function o(e,t,n=.01){const o=Math.abs((e.r||0)-(t.r||0)),i=Math.abs((e.g||0)-(t.g||0)),s=Math.abs((e.b||0)-(t.b||0));let r=0;return"a"in e&&"a"in t&&(r=Math.abs(e.a-t.a)),o<=n&&i<=n&&s<=n&&r<=n}function i(e,t){const n=(e.r-t.r)*(e.r-t.r),o=(e.g-t.g)*(e.g-t.g),i=(e.b-t.b)*(e.b-t.b);let s=0;return"a"in e&&"a"in t?(s=(e.a-t.a)*(e.a-t.a),Math.sqrt(n+o+i+s)):Math.sqrt(n+o+i)}function s(e,t,n={r:1,g:0,b:0}){const o=figma.createRectangle();return o.name=`[Issue] ${t} - ${e.name}`,o.resize(e.width+4,e.height+4),o.x=e.absoluteTransform[0][2]-2,o.y=e.absoluteTransform[1][2]-2,o.fills=[{type:"SOLID",color:{r:0,g:0,b:0},opacity:0}],o.strokes=[{type:"SOLID",color:n}],o.strokeWeight=2,o.dashPattern=[4,4],o}function r(e){const t=[];if("SOLID"!==e.type)return t;const i=figma.getLocalPaintStyles();for(const s of i){if(1!==s.paints.length)continue;const i=s.paints[0];if("SOLID"===i.type&&o(i.color,e.color)){const e=Object.assign(Object.assign({},i.color),{a:1});t.push({name:s.name,id:s.id,value:n(e),source:"Local"})}}return t}function a(e,t){return e.length===t.length&&e.every(((e,n)=>{const i=t[n];if(e.type!==i.type)return!1;if(e.visible!==i.visible)return!1;if("DROP_SHADOW"===e.type||"INNER_SHADOW"===e.type){const t=e,n=i;return t.radius===n.radius&&t.offset.x===n.offset.x&&t.offset.y===n.offset.y&&t.spread===n.spread&&o(t.color,n.color)}if("LAYER_BLUR"===e.type||"BACKGROUND_BLUR"===e.type){const t=i;return e.radius===t.radius}return!0}))}function l(e){return e.map((e=>e.type)).join(", ")}function c(e,t,n,o,i){const s=figma.variables.getVariableById(n);if(!s)return;const r=figma.variables.getVariableCollectionById(s.variableCollectionId);if(r&&!(r.name.includes("Design System")||r.name.includes("Tokens")||r.name.includes("DS"))){let n=[];const a=r.modes[0].modeId,l=s.valuesByMode[a];"fills"===t||"strokes"===t?"COLOR"===s.resolvedType&&(n=d(l,o.colorTokens)):t.includes("Radius")?n=f(l,o.borderRadiusTokens):(t.includes("padding")||t.includes("Spacing")||"itemSpacing"===t)&&(n=f(l,o.spacingTokens)),i.push({node:{id:e.id,name:e.name,type:e.type},type:"variable",message:`Using non-design system variable for ${t}`,value:`${s.name} (${r.name})`,suggestions:n})}}function d(e,t){const o=[],s=[],r="a"in e?e:Object.assign(Object.assign({},e),{a:1});for(const[e,n]of t){const t=Object.keys(n.valuesByMode)[0],o=n.valuesByMode[t];if("object"==typeof o&&"r"in o){const t="a"in o?o:Object.assign(Object.assign({},o),{a:1});s.push({id:e,color:t,name:n.name})}}const a=function(e,t){if(0===t.length)return null;let n=null,o=Number.MAX_VALUE;for(const s of t){const t=i(e,s.color);t<o&&(o=t,n=Object.assign(Object.assign({},s),{distance:t}))}return n}(r,s);return a&&o.push({name:a.name,id:a.id,value:n(a.color),distance:a.distance}),o}function f(e,t){if(!t||t instanceof Map&&0===t.size||Array.isArray(t)&&0===t.length)return[];const n=t instanceof Map?p(t):t,o=n.filter((t=>t.value===e));return o.length>0?o.map((e=>({name:e.name,id:e.id,value:e.value.toString(),distance:0}))):n.map((t=>({token:t,distance:Math.abs(t.value-e)}))).filter((t=>t.distance/e<.1)).sort(((e,t)=>e.distance-t.distance)).slice(0,3).map((e=>({name:e.token.name,id:e.token.id,value:e.token.value.toString(),distance:e.distance})))}function y(e,t,o,i){if(!(i in e))return;const s="fills"===i?"fills"in e?e.fills:null:"strokes"in e?e.strokes:null;if(s&&"symbol"!=typeof s&&!(("fills"===i?"fillStyleId"in e&&e.fillStyleId:"strokeStyleId"in e&&e.strokeStyleId)||"boundVariables"in e&&e.boundVariables&&e.boundVariables[i]))for(const r of s)if(!1!==r.visible&&"SOLID"===r.type){const s=d(r.color,t.colorTokens);if(s.length>0){const t=n(Object.assign(Object.assign({},r.color),{a:1}));o.push({node:{id:e.id,name:e.name,type:e.type},type:"missingVariable",message:("fills"===i?"Fill":"Stroke")+" color should use a variable token",value:t,property:i,suggestions:s})}}}function m(e){return e.replace(/([A-Z])/g," $1").replace(/^./,(e=>e.toUpperCase()))}function p(e){const t=[];if(!e)return t;for(const[n,o]of e.entries())if(o&&o.valuesByMode)try{const e=Object.keys(o.valuesByMode);if(0===e.length)continue;const i=e[0],s=o.valuesByMode[i];"number"==typeof s&&s>0&&t.push({id:n,name:o.name,value:s})}catch(e){console.warn("Error processing variable in convertVariableMapToTokenInfoArray:",e)}return t}function u(e,t,n,o){const i=figma.createFrame();i.name=t,i.resize(288,28),i.fills=[{type:"SOLID",color:{r:.95,g:.95,b:.95}}],i.cornerRadius=4,i.layoutMode="HORIZONTAL",i.counterAxisAlignItems="CENTER",i.primaryAxisSizingMode="FIXED",i.counterAxisSizingMode="AUTO",i.paddingLeft=12,i.paddingRight=12,e.appendChild(i);const s=figma.createText();s.characters=t,s.fontSize=12,s.fontName={family:"Inter",style:"Regular"},i.appendChild(s);const r=figma.createText();r.characters=n,r.fontSize=12,r.fontName={family:"Inter",style:"Medium"},r.fills=[{type:"SOLID",color:o}],r.layoutAlign="STRETCH",r.textAlignHorizontal="RIGHT",i.appendChild(r)}function g(e){return e<50?{r:.9,g:.3,b:.3}:e<80?{r:1,g:.6,b:.1}:{r:.3,g:.7,b:.3}}var h=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((o=o.apply(e,t||[])).next())}))};function b(e){return h(this,void 0,void 0,(function*(){try{const t=yield figma.teamLibrary.getComponentMetadataAsync(e.id);for(const n of t)e.components.push({id:n.key,key:n.key,name:n.name})}catch(t){console.error(`Error loading components for library ${e.name}:`,t)}}))}function v(e){return h(this,void 0,void 0,(function*(){try{const t=yield figma.teamLibrary.getStyleMetadataAsync(e.id);for(const n of t)e.styles.push({id:n.key,key:n.key,name:n.name,type:n.styleType})}catch(t){console.error(`Error loading styles for library ${e.name}:`,t)}}))}var S=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((o=o.apply(e,t||[])).next())}))};function C(e){return S(this,void 0,void 0,(function*(){try{const n=figma.currentPage.selection.length>0?[...figma.currentPage.selection]:[...figma.currentPage.children];figma.notify("Analyzing design system usage...",{timeout:1e4});const o=yield function(){return h(this,void 0,void 0,(function*(){const e=[];try{const t=yield figma.teamLibrary.getAvailableLibrariesAsync();for(const n of t)(n.name.includes("Design System")||n.name.includes("DS")||n.name.includes("Tokens")||n.name.includes("Components"))&&e.push({id:n.key,name:n.name,components:[],styles:[],variables:[]});for(const t of e)yield b(t),yield v(t)}catch(e){console.error("Error detecting libraries:",e)}return e}))}(),i=function(){const e=[],t=figma.getLocalPaintStyles(),n=figma.getLocalTextStyles(),o=figma.getLocalEffectStyles(),i=figma.getLocalGridStyles(),s=figma.variables.getLocalVariableCollections(),r=t.length+n.length+o.length+i.length>30,a=figma.root.findAllWithCriteria({types:["COMPONENT","COMPONENT_SET"]}).length>10,l=s.length>0;if(r||a||l){const r={id:"local",name:figma.root.name,components:[],styles:[],variables:[]},a=figma.root.findAllWithCriteria({types:["COMPONENT"]});for(const e of a)r.components.push({id:e.id,key:e.key,name:e.name});for(const e of t)r.styles.push({id:e.id,key:e.key,name:e.name,type:"PAINT"});for(const e of n)r.styles.push({id:e.id,key:e.key,name:e.name,type:"TEXT"});for(const e of o)r.styles.push({id:e.id,key:e.key,name:e.name,type:"EFFECT"});for(const e of i)r.styles.push({id:e.id,key:e.key,name:e.name,type:"GRID"});for(const e of s){const t=figma.variables.getVariablesByCollection(e.id);for(const n of t)r.variables.push({id:n.id,name:n.name,resolvedType:n.resolvedType,collectionName:e.name})}e.push(r)}return e}(),r=[...o,...i],a=yield function(){const e={colorTokens:new Map,typographyTokens:new Map,spacingTokens:new Map,borderRadiusTokens:new Map,shadowTokens:new Map},t=figma.variables.getLocalVariableCollections();for(const n of t)if(n.name.includes("Design System")||n.name.includes("Tokens")||n.name.includes("DS")){const t=figma.variables.getVariablesByCollection(n.id);for(const n of t){const t=n.name.toLowerCase();t.includes("color")||t.includes("fill")||t.includes("background")||"COLOR"===n.resolvedType?e.colorTokens.set(n.id,n):t.includes("spacing")||t.includes("space")||t.includes("gap")||t.includes("padding")||t.includes("margin")?e.spacingTokens.set(n.id,n):t.includes("radius")||t.includes("corner")?e.borderRadiusTokens.set(n.id,n):t.includes("shadow")||t.includes("elevation")?e.shadowTokens.set(n.id,n):(t.includes("type")||t.includes("font")||t.includes("text")||t.includes("typography"))&&e.typographyTokens.set(n.id,n)}}return e}();let l=0,c=0;for(const e of n)c+=k(e);const d=[],f=[],y=[];for(const e of n)yield I(e,d,f,y,a,100,(e=>{l+=e,figma.notify(`Analyzing design system usage: ${Math.round(l/c*100)}%`,{timeout:1e4})}));const m=d.map((e=>{var t,n;return{node:{id:e.node.id,name:e.node.name,type:e.node.type},type:e.type,message:e.message,details:e.details,mainComponent:e.mainComponent,mainComponentId:null===(t=e.mainComponent)||void 0===t?void 0:t.id,mainComponentName:null===(n=e.mainComponent)||void 0===n?void 0:n.name}})),p=f.map((e=>{var t;return{node:{id:e.node.id,name:e.node.name,type:e.node.type},type:e.type,message:e.message,value:e.value,suggestions:null===(t=e.suggestions)||void 0===t?void 0:t.map((e=>({name:e.name,id:e.id,value:e.value,source:e.source})))}})),S=function(e,n){const o={totalNodes:0,libraryComponents:0,localComponents:0,modifiedComponents:0,detachedComponents:0,nodesWithStyles:0,nodesWithoutStyles:0,nodesWithVariables:0,nodesWithoutVariables:0,componentCoverage:0,styleCoverage:0,variableCoverage:0,overallCoverage:0},i=new Set;for(const n of e)t(n,(e=>{var t;if(!i.has(e.id)){if(i.add(e.id),o.totalNodes++,"INSTANCE"===e.type){const n=e;(null===(t=n.mainComponent)||void 0===t?void 0:t.remote)?o.libraryComponents++:n.mainComponent&&o.localComponents++}"fillStyleId"in e&&e.fillStyleId&&"symbol"!=typeof e.fillStyleId||"strokeStyleId"in e&&e.strokeStyleId&&"symbol"!=typeof e.strokeStyleId||"effectStyleId"in e&&e.effectStyleId&&"symbol"!=typeof e.effectStyleId||"TEXT"===e.type&&e.textStyleId&&"symbol"!=typeof e.textStyleId?o.nodesWithStyles++:("fills"in e&&e.fills&&"symbol"!=typeof e.fills&&e.fills.length>0||"strokes"in e&&e.strokes&&"symbol"!=typeof e.strokes&&e.strokes.length>0||"effects"in e&&e.effects&&"symbol"!=typeof e.effects&&e.effects.length>0||"TEXT"===e.type)&&o.nodesWithoutStyles++,"boundVariables"in e&&e.boundVariables&&Object.keys(e.boundVariables).length>0?o.nodesWithVariables++:("cornerRadius"in e&&e.cornerRadius&&0!==e.cornerRadius&&"symbol"!=typeof e.cornerRadius||"fills"in e&&e.fills&&"symbol"!=typeof e.fills&&e.fills.some((e=>"SOLID"===e.type))||"strokes"in e&&e.strokes&&"symbol"!=typeof e.strokes&&e.strokes.some((e=>"SOLID"===e.type)))&&o.nodesWithoutVariables++}}),(e=>{var t;return!("INSTANCE"!==e.type||!(null===(t=e.mainComponent)||void 0===t?void 0:t.remote))}));for(const e of n)"detached"===e.type?(o.detachedComponents++,o.libraryComponents--):e.type.startsWith("modified")&&(i.has("modified-"+e.node.id)||(i.add("modified-"+e.node.id),o.modifiedComponents++));o.libraryComponents+o.localComponents+o.detachedComponents>0&&(o.componentCoverage=o.libraryComponents/(o.libraryComponents+o.localComponents+o.detachedComponents)*100),o.nodesWithStyles+o.nodesWithoutStyles>0&&(o.styleCoverage=o.nodesWithStyles/(o.nodesWithStyles+o.nodesWithoutStyles)*100),o.nodesWithVariables+o.nodesWithoutVariables>0&&(o.variableCoverage=o.nodesWithVariables/(o.nodesWithVariables+o.nodesWithoutVariables)*100);const s=o.libraryComponents+o.localComponents+o.detachedComponents+o.nodesWithStyles+o.nodesWithoutStyles+o.nodesWithVariables+o.nodesWithoutVariables,r=o.libraryComponents+o.nodesWithStyles+o.nodesWithVariables;return s>0&&(o.overallCoverage=r/s*100),o}(n,m);if((null==e?void 0:e.visualize)&&function(e,t,n){const o=figma.currentPage.findAll((e=>"RECTANGLE"===e.type&&e.name.startsWith("[Issue]")));for(const e of o)e.remove();const i=figma.createFrame();i.name="Design System Issues",i.fills=[],i.locked=!0,i.expanded=!1;for(const t of e){const e=figma.getNodeById(t.node.id);if(e){const n=s(e,t.message,{r:1,g:0,b:0});i.appendChild(n)}}for(const e of t){const t=figma.getNodeById(e.node.id);if(t){const n=s(t,e.message,{r:1,g:.6,b:0});i.appendChild(n)}}for(const e of n){const t=figma.getNodeById(e.node.id);if(t){const n=s(t,e.message,{r:1,g:.8,b:0});i.appendChild(n)}}0===i.children.length&&i.remove()}(m,p,y),(null==e?void 0:e.generateReport)&&n.length>0){let e=n[0];if("parent"in e&&e.parent&&"FRAME"===e.parent.type)e=e.parent;else if("FRAME"!==e.type){const t=figma.createFrame();t.name="Design System Report Frame",t.resize(600,400),e=t}!function(e,t){const n=figma.createFrame();n.name="Design System Coverage Report",n.resize(320,400),n.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],n.cornerRadius=8,n.x=t.x+t.width+40,n.y=t.y;const o=figma.createFrame();o.name="Header",o.resize(320,60),o.fills=[{type:"SOLID",color:{r:.9,g:.9,b:.9}}],o.x=0,o.y=0,n.appendChild(o);const i=figma.createText();i.characters="Design System Coverage",i.fontSize=18,i.x=16,i.y=16,i.fontName={family:"Inter",style:"Medium"},o.appendChild(i);const s=figma.createFrame();s.name="Overall Coverage",s.resize(288,80),s.fills=[{type:"SOLID",color:{r:.95,g:.95,b:.95}}],s.cornerRadius=4,s.x=16,s.y=76,n.appendChild(s);const r=figma.createText();r.characters="Overall Coverage",r.fontSize=14,r.x=16,r.y=16,r.fontName={family:"Inter",style:"Medium"},s.appendChild(r);const a=figma.createText();a.characters=`${e.overallCoverage.toFixed(1)}%`,a.fontSize=24,a.x=16,a.y=40,a.fontName={family:"Inter",style:"Bold"},e.overallCoverage<50?a.fills=[{type:"SOLID",color:{r:.9,g:.3,b:.3}}]:e.overallCoverage<80?a.fills=[{type:"SOLID",color:{r:1,g:.6,b:.1}}]:a.fills=[{type:"SOLID",color:{r:.3,g:.7,b:.3}}],s.appendChild(a);const l=figma.createFrame();l.name="Metrics",l.resize(288,228),l.fills=[],l.layoutMode="VERTICAL",l.primaryAxisSizingMode="AUTO",l.counterAxisSizingMode="FIXED",l.itemSpacing=8,l.x=16,l.y=172,n.appendChild(l),u(l,"Component Coverage",`${e.componentCoverage.toFixed(1)}%`,g(e.componentCoverage)),u(l,"Library Components",e.libraryComponents.toString(),{r:0,g:0,b:0}),u(l,"Local Components",e.localComponents.toString(),{r:0,g:0,b:0}),u(l,"Modified Components",e.modifiedComponents.toString(),{r:0,g:0,b:0}),u(l,"Style Coverage",`${e.styleCoverage.toFixed(1)}%`,g(e.styleCoverage)),u(l,"Variable Coverage",`${e.variableCoverage.toFixed(1)}%`,g(e.variableCoverage)),u(l,"Total Nodes",e.totalNodes.toString(),{r:0,g:0,b:0})}(S,e)}figma.ui.postMessage({type:"checkResults",payload:{componentResults:m,styleResults:p,tokenResults:y,metrics:S,libraries:r}}),figma.notify("Design system check complete!")}catch(e){console.error("Error during design system check:",e),figma.notify("Error running design system check",{error:!0})}}))}function k(e){let t=1;if("children"in e)for(const n of e.children)t+=k(n);return t}function I(e,t,n,o,i,s,r){return S(this,void 0,void 0,(function*(){let a=[e],l=0;for(;a.length>0;){const e=a.shift();yield T(e,t,n,o,i),l++,"children"in e&&(a=[...a,...e.children]),l>=s&&(r(l),l=0,yield new Promise((e=>setTimeout(e,0))))}l>0&&r(l)}))}function T(t,o,i,s,d){try{if(!e(t))return;if("INSTANCE"===t.type){const e=function(e){const t=[],n=function(e){return!!e.mainComponent&&null!==e.mainComponent.remote}(e);return e.mainComponent?!n&&e.mainComponent?t.push({node:e,type:"nonLibrary",message:"Component is not from a team library",details:"Using team library components improves consistency",mainComponent:e.mainComponent}):e.mainComponent&&function(e,t){const n=function(e){const t=[],n=function(e){const t=[];return function e(n){if("TEXT"===n.type&&t.push(n),"children"in n)for(const t of n.children)e(t)}(e),t}(e);for(const e of n){const n=e.mainComponent;n&&e.characters!==n.characters&&t.push("text")}const o=function(e){const t=[];return function e(n){if("fills"in n&&n.fills&&n.fills.length>0&&t.push(n),"children"in n)for(const t of n.children)e(t)}(e),t}(e);for(const e of o){const n=e.mainComponent,o="fills"in e?e.fills:void 0,i=n?n.fills:void 0;n&&JSON.stringify(o)!==JSON.stringify(i)&&t.push("fills")}const i=function(e){const t=[];return function e(n){if("strokes"in n&&n.strokes&&n.strokes.length>0&&t.push(n),"children"in n)for(const t of n.children)e(t)}(e),t}(e);for(const e of i){const n=e.mainComponent,o="strokes"in e?e.strokes:void 0,i=n?n.strokes:void 0;n&&JSON.stringify(o)!==JSON.stringify(i)&&t.push("strokes")}return t}(e);n.length>0&&e.mainComponent&&(e.width===e.mainComponent.width&&e.height===e.mainComponent.height||"SCALE"===e.constraints.horizontal&&"SCALE"===e.constraints.vertical&&t.push({node:e,type:"modified-size",message:"Component size has been modified",details:`Size changed from ${e.mainComponent.width}×${e.mainComponent.height} to ${e.width}×${e.height}`,mainComponent:e.mainComponent}),n.length>2&&t.push({node:e,type:"modified-styles",message:"Component has significant style overrides",details:`${n.length} properties have been overridden`,mainComponent:e.mainComponent}),function(e,t){var n;if(e.mainComponent){if(e.name.toLowerCase().includes("button")){const o=function(e){const t=[];return function e(n){if("RECTANGLE"===n.type&&t.push(n),"children"in n)for(const t of n.children)e(t)}(e),t}(e);for(const i of o){const o=i.cornerRadius,s=null===(n=i.boundVariables)||void 0===n?void 0:n.cornerRadius;if(void 0!==o&&o!==s){t.push({node:e,type:"modified-forbidden",message:"Button component has modified corner radius",details:"Button corner radii should be standardized across the design system",mainComponent:e.mainComponent});break}}}if(e.name.toLowerCase().includes("card")){const n=function(e){const t=[];return function e(n){if("effects"in n&&n.effects&&n.effects.length>0&&t.push(n),"children"in n)for(const t of n.children)e(t)}(e),t}(e);for(const o of n){const n=o;if(n.effects&&n.effects.length>0&&!n.effectStyleId){t.push({node:e,type:"modified-forbidden",message:"Card component has modified shadow",details:"Card shadows should use the design system standard elevation tokens",mainComponent:e.mainComponent});break}}}}}(e,t))}(e,t):t.push({node:e,type:"detached",message:"Component is detached from its main component",details:"Detached components lose their connection to the design system"}),t}(t);o.push(...e)}try{const e=function(e){const t=[];if(!("fills"in e)||"symbol"==typeof e.fills)return t;if(!e.fills||0===e.fills.length||!e.visible)return t;const o=e.fills.filter((e=>!1!==e.visible));if(0===o.length)return t;if(!e.fillStyleId&&o.length>0)for(const i of o)if("SOLID"===i.type&&!e.fillStyleId){const o=i.color,s=n({r:o.r,g:o.g,b:o.b,a:1});t.push({node:{id:e.id,name:e.name,type:e.type},type:"fill",message:"Node has fill without a style",value:s,suggestions:[]})}if("fills"in e&&"symbol"!=typeof e.fills&&e.fills.length>1){const n=e.fills.filter((e=>"SOLID"===e.type&&!1!==e.visible));n.length>1&&!e.fillStyleId&&t.push({node:{id:e.id,name:e.name,type:e.type},type:"fill",message:"Multiple solid fills without a style",value:`${n.length} solid fills`,suggestions:[]})}return t}(t);i.push(...e)}catch(e){console.warn(`Error checking fills for ${t.name}:`,e)}try{const e=function(e){const t=[];if(!("strokes"in e)||!e.strokes)return t;if("symbol"==typeof e.strokes)return t;if("strokeStyleId"in e&&!e.strokeStyleId){const o=e.strokes;if(0===o.length||!o.some((e=>!1!==e.visible)))return t;for(const i of o)if(!1!==i.visible&&"SOLID"===i.type){const o=n(Object.assign(Object.assign({},i.color),{a:1})),s=r(i);t.push({node:{id:e.id,name:e.name,type:e.type},type:"stroke",message:"Missing stroke style",value:o,suggestions:s})}}return t}(t);i.push(...e)}catch(e){console.warn(`Error checking strokes for ${t.name}:`,e)}try{const e=function(e){const t=[];if("TEXT"!==e.type)return t;if(!e.textStyleId){const n=`${"symbol"==typeof e.fontName?"Mixed fonts":`${e.fontName.family} ${e.fontName.style}`}, ${"symbol"==typeof e.fontSize?"Mixed sizes":`${e.fontSize}px`}`,o=function(e){const t=[];if("symbol"==typeof e.fontName||"symbol"==typeof e.fontSize)return t;const n=figma.getLocalTextStyles();for(const o of n)o.fontName.family===e.fontName.family&&o.fontName.style===e.fontName.style&&o.fontSize===e.fontSize&&t.push({name:o.name,id:o.id,value:`${o.fontName.family} ${o.fontName.style}, ${o.fontSize}px`,source:"Local"});return t}(e);t.push({node:{id:e.id,name:e.name,type:e.type},type:"text",message:"Missing text style",value:n,suggestions:o})}return t}(t);i.push(...e)}catch(e){console.warn(`Error checking text styles for ${t.name}:`,e)}try{const e=function(e){const t=[];return"effects"in e&&e.effects?("symbol"==typeof e.effects||"effectStyleId"in e&&!e.effectStyleId&&function(e,t,n){if(0===t.length)return;const o=t.map((e=>"DROP_SHADOW"===e.type?"Drop Shadow":"INNER_SHADOW"===e.type?"Inner Shadow":"LAYER_BLUR"===e.type?"Layer Blur":"BACKGROUND_BLUR"===e.type?"Background Blur":e.type)).join(", "),i=function(e){const t=[],n=figma.getLocalEffectStyles();for(const o of n){const n=[...o.effects];a(e,n)&&t.push({name:o.name,id:o.id,value:l(n),source:"Local"})}return t}(t);n.push({node:{id:e.id,name:e.name,type:e.type},type:"effect",message:"Missing effect style",value:o,suggestions:i})}(e,[...e.effects],t),t):t}(t);i.push(...e)}catch(e){console.warn(`Error checking effects for ${t.name}:`,e)}try{const e=function(e,t){const n=[];if(!("boundVariables"in e)||!e.boundVariables)return n;const o=["fills","strokes","effects","layoutGrids","opacity","cornerRadius","topLeftRadius","topRightRadius","bottomLeftRadius","bottomRightRadius","paddingLeft","paddingRight","paddingTop","paddingBottom","itemSpacing","counterAxisSpacing","strokeWeight","strokeTopWeight","strokeRightWeight","strokeBottomWeight","strokeLeftWeight"];for(const i of o){const o=e.boundVariables;if(i in o)if(Array.isArray(o[i]))for(const s of o[i])c(e,i,s.id,t,n);else c(e,i,o[i].id,t,n)}return n}(t,d);s.push(...e)}catch(e){console.warn(`Error checking variables for ${t.name}:`,e)}try{const n=function(t,n){const o=[];if(!e(t)||(i=t.type,["CONNECTOR","SHAPE_WITH_TEXT","STICKY","CODE_BLOCK","WIDGET"].includes(i)))return o;var i;if("fills"in t&&t.fills&&"symbol"!=typeof t.fills&&y(t,n,o,"fills"),"strokes"in t&&t.strokes&&"symbol"!=typeof t.strokes&&y(t,n,o,"strokes"),"cornerRadius"in t&&"number"==typeof t.cornerRadius&&t.cornerRadius>0&&function(e,t,n){if(!("cornerRadius"in e))return;const o=e.cornerRadius;if("number"!=typeof o||0===o)return;if("boundVariables"in e&&e.boundVariables&&e.boundVariables.cornerRadius)return;const i=f(o,p(t.borderRadiusTokens));i.length>0&&n.push({node:{id:e.id,name:e.name,type:e.type},type:"missingVariable",message:"Border radius should use a variable token",value:o.toString(),property:"cornerRadius",suggestions:i})}(t,n,o),"itemSpacing"in t&&"number"==typeof t.itemSpacing){const e=p(n.spacingTokens),i=f(t.itemSpacing,e),s="boundVariables"in t&&t.boundVariables&&t.boundVariables.itemSpacing;i.length>0&&!s&&o.push({node:{id:t.id,name:t.name,type:t.type},type:"missingVariable",message:"Layout spacing should use a spacing token",value:t.itemSpacing.toString(),suggestions:i})}return("paddingLeft"in t||"paddingRight"in t||"paddingTop"in t||"paddingBottom"in t)&&function(e,t,n){const o=["paddingLeft","paddingRight","paddingTop","paddingBottom"],i=p(t.spacingTokens);for(const t of o)if(t in e&&"number"==typeof e[t]&&e[t]>0){const o=e[t];if(!("boundVariables"in e&&e.boundVariables&&e.boundVariables[t])){const s=f(o,i);s.length>0&&n.push({node:{id:e.id,name:e.name,type:e.type},type:"missingVariable",message:`${m(t)} should use a spacing token`,value:o.toString(),property:t,suggestions:s})}}}(t,n,o),"TEXT"===t.type&&function(e,t,n){if(e.textStyleId)return;const o=p(t.typographyTokens),i=[{prop:"fontSize",message:"Font size"},{prop:"lineHeight",message:"Line height"},{prop:"letterSpacing",message:"Letter spacing"}];for(const{prop:t,message:s}of i)if(t in e&&"number"==typeof e[t]&&e[t]>0){const i=e[t];if(!("boundVariables"in e&&e.boundVariables&&e.boundVariables[t])){const r=f(i,o);r.length>0&&n.push({node:{id:e.id,name:e.name,type:e.type},type:"missingVariable",message:`${s} should use a typography token`,value:i.toString(),property:t,suggestions:r})}}if(e.fontName&&"symbol"!=typeof e.fontName&&!("boundVariables"in e&&e.boundVariables&&e.boundVariables.fontName)){const o=t.fontFamilies||[];!o.includes(e.fontName.family)&&o.length>0&&n.push({node:{id:e.id,name:e.name,type:e.type},type:"missingVariable",message:"Font family not from design system",value:`${e.fontName.family} ${e.fontName.style}`,property:"fontName",suggestions:[]})}}(t,n,o),o}(t,d);s.push(...n)}catch(e){console.warn(`Error checking missing variables for ${t.name}:`,e)}if("children"in t)for(const e of t.children)T(e,o,i,s,d)}catch(e){console.warn(`Error processing node ${t.name}:`,e)}}function R(e){return S(this,void 0,void 0,(function*(){try{const t=figma.getNodeById(e.nodeId);if(!t)return void figma.notify("Node not found",{error:!0});"style"===e.type?yield function(e,t){return S(this,void 0,void 0,(function*(){if("Local"!==t.style.source)try{const n=yield figma.importStyleByKeyAsync(t.style.key);"fill"===t.styleType&&"fillStyleId"in e?e.fillStyleId=n.id:"stroke"===t.styleType&&"strokeStyleId"in e?e.strokeStyleId=n.id:"effect"===t.styleType&&"effectStyleId"in e?e.effectStyleId=n.id:"text"===t.styleType&&"TEXT"===e.type&&(e.textStyleId=n.id)}catch(e){throw console.error("Error importing style:",e),new Error("Failed to import style from library")}else"fill"===t.styleType&&"fillStyleId"in e?e.fillStyleId=t.style.id:"stroke"===t.styleType&&"strokeStyleId"in e?e.strokeStyleId=t.style.id:"effect"===t.styleType&&"effectStyleId"in e?e.effectStyleId=t.style.id:"text"===t.styleType&&"TEXT"===e.type&&(e.textStyleId=t.style.id)}))}(t,e):"variable"===e.type?yield function(e,t){return S(this,void 0,void 0,(function*(){const n=figma.variables.getVariableById(t.variable.id);if(!n)throw new Error("Variable not found");switch(t.property){case"fills":"fills"in e&&e.setBoundVariable("fills",0,n);break;case"strokes":"strokes"in e&&e.setBoundVariable("strokes",0,n);break;case"cornerRadius":"cornerRadius"in e&&e.setBoundVariable("cornerRadius",n);break;case"topLeftRadius":case"topRightRadius":case"bottomLeftRadius":case"bottomRightRadius":t.property in e&&e.setBoundVariable(t.property,n);break;default:throw new Error(`Unsupported property: ${t.property}`)}}))}(t,e):"component"===e.type&&(yield function(e,t){return S(this,void 0,void 0,(function*(){if("INSTANCE"!==e.type)throw new Error("Node is not an instance");if("reset"===t.fixType)e.resetOverrides();else if("swap"===t.fixType)try{const n=(yield figma.importComponentByKeyAsync(t.componentKey)).createInstance();if(n.x=e.x,n.y=e.y,n.resize(e.width,e.height),e.parent){const t=e.parent.children.indexOf(e);e.parent.insertChild(t,n)}e.remove()}catch(e){throw console.error("Error swapping component:",e),new Error("Failed to swap component")}}))}(t,e)),figma.notify("Fix applied successfully!")}catch(e){console.error("Error applying fix:",e),figma.notify("Error applying fix",{error:!0})}}))}figma.showUI(__html__,{width:500,height:600}),figma.ui.onmessage=e=>S(void 0,void 0,void 0,(function*(){var t,n;try{if("checkDesignSystem"===e.type)figma.notify("Analyzing design system usage...",{timeout:1e4}),yield C(null===(t=e.payload)||void 0===t?void 0:t.options);else if("highlightNode"===e.type){const t=e.payload.nodeId,n=figma.getNodeById(t);n&&(figma.currentPage.selection=[n],figma.viewport.scrollAndZoomIntoView([n]))}else"applyFix"===e.type?(yield R(e.payload.fix),yield C()):"applyBatchFixes"===e.type?yield function(e){return S(this,void 0,void 0,(function*(){figma.notify(`Applying ${e.length} fixes...`,{timeout:1e4});let t=0,n=0;for(let o=0;o<e.length;o+=10){const i=e.slice(o,o+10);for(const e of i)try{yield R(e),t++}catch(e){console.error(`Error applying fix ${o}:`,e),n++}figma.notify(`Applied ${o+i.length} of ${e.length} fixes...`,{timeout:1e4}),yield new Promise((e=>setTimeout(e,100)))}figma.notify(`Applied ${t} fixes successfully. ${n} fixes failed.`),figma.ui.postMessage({type:"batchFixComplete",payload:{totalFixes:e.length,successCount:t,failCount:n}})}))}(e.payload.fixes):"exportReport"===e.type?(n=e.payload.metrics,figma.ui.postMessage({type:"exportReportData",payload:JSON.stringify(n,null,2)})):"close"===e.type&&figma.closePlugin()}catch(e){console.error("Error handling message:",e),figma.notify("An unexpected error occurred",{error:!0}),figma.ui.postMessage({type:"error",payload:{message:e.message||"Unknown error"}})}})),function(){S(this,void 0,void 0,(function*(){"check-design-system"===figma.command?yield C({visualize:!0}):"configure-settings"===figma.command||(yield C())}))}()})();