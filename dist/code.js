(()=>{"use strict";function e(e){return e.visible}function t(o,n,i){if((!("visible"in o)||e(o))&&("type"in o&&n(o),!(i&&"type"in o&&i(o))&&"children"in o))for(const e of o.children)t(e,n,i)}function o(e){const t=Math.round(255*e.r),o=Math.round(255*e.g),n=Math.round(255*e.b);return`#${t.toString(16).padStart(2,"0")}${o.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}`}function n(e,t,o=.01){const n=Math.abs((e.r||0)-(t.r||0)),i=Math.abs((e.g||0)-(t.g||0)),s=Math.abs((e.b||0)-(t.b||0));let r=0;return"a"in e&&"a"in t&&(r=Math.abs(e.a-t.a)),n<=o&&i<=o&&s<=o&&r<=o}function i(e,t){const o=(e.r-t.r)*(e.r-t.r),n=(e.g-t.g)*(e.g-t.g),i=(e.b-t.b)*(e.b-t.b);let s=0;return"a"in e&&"a"in t?(s=(e.a-t.a)*(e.a-t.a),Math.sqrt(o+n+i+s)):Math.sqrt(o+n+i)}function s(e,t,o={r:1,g:0,b:0}){const n=figma.createRectangle();return n.name=`[Issue] ${t} - ${e.name}`,n.resize(e.width+4,e.height+4),n.x=e.absoluteTransform[0][2]-2,n.y=e.absoluteTransform[1][2]-2,n.fills=[{type:"SOLID",color:{r:0,g:0,b:0},opacity:0}],n.strokes=[{type:"SOLID",color:o}],n.strokeWeight=2,n.dashPattern=[4,4],n}function r(e){const t=[];if("SOLID"!==e.type)return t;const i=figma.getLocalPaintStyles();for(const s of i){if(1!==s.paints.length)continue;const i=s.paints[0];if("SOLID"===i.type&&n(i.color,e.color)){const e=Object.assign(Object.assign({},i.color),{a:1});t.push({name:s.name,id:s.id,value:o(e),source:"Local"})}}return t}function a(e,t){return e.length===t.length&&e.every(((e,o)=>{const i=t[o];if(e.type!==i.type)return!1;if(e.visible!==i.visible)return!1;if("DROP_SHADOW"===e.type||"INNER_SHADOW"===e.type){const t=e,o=i;return t.radius===o.radius&&t.offset.x===o.offset.x&&t.offset.y===o.offset.y&&t.spread===o.spread&&n(t.color,o.color)}if("LAYER_BLUR"===e.type||"BACKGROUND_BLUR"===e.type){const t=i;return e.radius===t.radius}return!0}))}function l(e){return e.map((e=>e.type)).join(", ")}function d(e,t,o,n,i){const s=figma.variables.getVariableById(o);if(!s)return;const r=figma.variables.getVariableCollectionById(s.variableCollectionId);if(r&&!(r.name.includes("Design System")||r.name.includes("Tokens")||r.name.includes("DS"))){let o=[];const a=r.modes[0].modeId,l=s.valuesByMode[a];"fills"===t||"strokes"===t?"COLOR"===s.resolvedType&&(o=c(l,n.colorTokens)):t.includes("Radius")?o=f(l,n.borderRadiusTokens):(t.includes("padding")||t.includes("Spacing")||"itemSpacing"===t)&&(o=f(l,n.spacingTokens)),i.push({node:e,type:"variable",message:`Using non-design system variable for ${t}`,value:`${s.name} (${r.name})`,suggestions:o})}}function c(e,t){const n=[],s=[],r="a"in e?e:Object.assign(Object.assign({},e),{a:1});for(const[e,o]of t){const t=Object.keys(o.valuesByMode)[0],n=o.valuesByMode[t];if("object"==typeof n&&"r"in n){const t="a"in n?n:Object.assign(Object.assign({},n),{a:1});s.push({id:e,color:t,name:o.name})}}const a=function(e,t){if(0===t.length)return null;let o=null,n=Number.MAX_VALUE;for(const s of t){const t=i(e,s.color);t<n&&(n=t,o=Object.assign(Object.assign({},s),{distance:t}))}return o}(r,s);return a&&n.push({name:a.name,id:a.id,value:o(a.color),distance:a.distance}),n}function f(e,t){const o=[];for(const[n,i]of t){const t=Object.keys(i.valuesByMode)[0],s=i.valuesByMode[t];"number"==typeof e&&"number"==typeof s?Math.abs(e-s)<.1&&o.push({name:i.name,id:n,value:s.toString()}):e===s&&o.push({name:i.name,id:n,value:JSON.stringify(s)})}return o}function y(e,t,o,n){const i=figma.createFrame();i.name=t,i.resize(288,28),i.fills=[{type:"SOLID",color:{r:.95,g:.95,b:.95}}],i.cornerRadius=4,i.layoutMode="HORIZONTAL",i.counterAxisAlignItems="CENTER",i.primaryAxisSizingMode="FIXED",i.counterAxisSizingMode="AUTO",i.paddingLeft=12,i.paddingRight=12,e.appendChild(i);const s=figma.createText();s.characters=t,s.fontSize=12,s.fontName={family:"Inter",style:"Regular"},i.appendChild(s);const r=figma.createText();r.characters=o,r.fontSize=12,r.fontName={family:"Inter",style:"Medium"},r.fills=[{type:"SOLID",color:n}],r.layoutAlign="STRETCH",r.textAlignHorizontal="RIGHT",i.appendChild(r)}function m(e){return e<50?{r:.9,g:.3,b:.3}:e<80?{r:1,g:.6,b:.1}:{r:.3,g:.7,b:.3}}var p=function(e,t,o,n){return new(o||(o=Promise))((function(i,s){function r(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};function u(e){return p(this,void 0,void 0,(function*(){try{const t=yield figma.teamLibrary.getComponentMetadataAsync(e.id);for(const o of t)e.components.push({id:o.key,key:o.key,name:o.name})}catch(t){console.error(`Error loading components for library ${e.name}:`,t)}}))}function g(e){return p(this,void 0,void 0,(function*(){try{const t=yield figma.teamLibrary.getStyleMetadataAsync(e.id);for(const o of t)e.styles.push({id:o.key,key:o.key,name:o.name,type:o.styleType})}catch(t){console.error(`Error loading styles for library ${e.name}:`,t)}}))}var h=function(e,t,o,n){return new(o||(o=Promise))((function(i,s){function r(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};function b(e){return h(this,void 0,void 0,(function*(){try{const o=figma.currentPage.selection.length>0?[...figma.currentPage.selection]:[...figma.currentPage.children],n=yield function(){return p(this,void 0,void 0,(function*(){const e=[];try{const t=yield figma.teamLibrary.getAvailableLibrariesAsync();for(const o of t)(o.name.includes("Design System")||o.name.includes("DS")||o.name.includes("Tokens")||o.name.includes("Components"))&&e.push({id:o.key,name:o.name,components:[],styles:[],variables:[]});for(const t of e)yield u(t),yield g(t)}catch(e){console.error("Error detecting libraries:",e)}return e}))}(),i=function(){const e=[],t=figma.getLocalPaintStyles(),o=figma.getLocalTextStyles(),n=figma.getLocalEffectStyles(),i=figma.getLocalGridStyles(),s=figma.variables.getLocalVariableCollections(),r=t.length+o.length+n.length+i.length>30,a=figma.root.findAllWithCriteria({types:["COMPONENT","COMPONENT_SET"]}).length>10,l=s.length>0;if(r||a||l){const r={id:"local",name:figma.root.name,components:[],styles:[],variables:[]},a=figma.root.findAllWithCriteria({types:["COMPONENT"]});for(const e of a)r.components.push({id:e.id,key:e.key,name:e.name});for(const e of t)r.styles.push({id:e.id,key:e.key,name:e.name,type:"PAINT"});for(const e of o)r.styles.push({id:e.id,key:e.key,name:e.name,type:"TEXT"});for(const e of n)r.styles.push({id:e.id,key:e.key,name:e.name,type:"EFFECT"});for(const e of i)r.styles.push({id:e.id,key:e.key,name:e.name,type:"GRID"});for(const e of s){const t=figma.variables.getVariablesByCollection(e.id);for(const o of t)r.variables.push({id:o.id,name:o.name,resolvedType:o.resolvedType,collectionName:e.name})}e.push(r)}return e}(),r=[...n,...i],a=yield function(){const e={colorTokens:new Map,typographyTokens:new Map,spacingTokens:new Map,borderRadiusTokens:new Map,shadowTokens:new Map},t=figma.variables.getLocalVariableCollections();for(const o of t)if(o.name.includes("Design System")||o.name.includes("Tokens")||o.name.includes("DS")){const t=figma.variables.getVariablesByCollection(o.id);for(const o of t){const t=o.name.toLowerCase();t.includes("color")||t.includes("fill")||t.includes("background")||"COLOR"===o.resolvedType?e.colorTokens.set(o.id,o):t.includes("spacing")||t.includes("space")||t.includes("gap")||t.includes("padding")||t.includes("margin")?e.spacingTokens.set(o.id,o):t.includes("radius")||t.includes("corner")?e.borderRadiusTokens.set(o.id,o):t.includes("shadow")||t.includes("elevation")?e.shadowTokens.set(o.id,o):(t.includes("type")||t.includes("font")||t.includes("text")||t.includes("typography"))&&e.typographyTokens.set(o.id,o)}}return e}(),l=[],d=[],c=[];for(const e of o)v(e,l,d,c,a);const f=l.map((e=>{var t,o;return{node:{id:e.node.id,name:e.node.name,type:e.node.type},type:e.type,message:e.message,details:e.details,mainComponent:e.mainComponent,mainComponentId:null===(t=e.mainComponent)||void 0===t?void 0:t.id,mainComponentName:null===(o=e.mainComponent)||void 0===o?void 0:o.name}})),h=d.map((e=>{var t;return{node:{id:e.node.id,name:e.node.name,type:e.node.type},type:e.type,message:e.message,value:e.value,suggestions:null===(t=e.suggestions)||void 0===t?void 0:t.map((e=>({name:e.name,id:e.id,value:e.value,source:e.source})))}})),b=function(e,o){const n={totalNodes:0,libraryComponents:0,localComponents:0,modifiedComponents:0,detachedComponents:0,nodesWithStyles:0,nodesWithoutStyles:0,nodesWithVariables:0,nodesWithoutVariables:0,componentCoverage:0,styleCoverage:0,variableCoverage:0,overallCoverage:0},i=new Set;for(const o of e)t(o,(e=>{var t;if(!i.has(e.id)){if(i.add(e.id),n.totalNodes++,"INSTANCE"===e.type){const o=e;(null===(t=o.mainComponent)||void 0===t?void 0:t.remote)?n.libraryComponents++:o.mainComponent&&n.localComponents++}"fillStyleId"in e&&e.fillStyleId&&"symbol"!=typeof e.fillStyleId||"strokeStyleId"in e&&e.strokeStyleId&&"symbol"!=typeof e.strokeStyleId||"effectStyleId"in e&&e.effectStyleId&&"symbol"!=typeof e.effectStyleId||"TEXT"===e.type&&e.textStyleId&&"symbol"!=typeof e.textStyleId?n.nodesWithStyles++:("fills"in e&&e.fills&&"symbol"!=typeof e.fills&&e.fills.length>0||"strokes"in e&&e.strokes&&"symbol"!=typeof e.strokes&&e.strokes.length>0||"effects"in e&&e.effects&&"symbol"!=typeof e.effects&&e.effects.length>0||"TEXT"===e.type)&&n.nodesWithoutStyles++,"boundVariables"in e&&e.boundVariables&&Object.keys(e.boundVariables).length>0?n.nodesWithVariables++:("cornerRadius"in e&&e.cornerRadius&&0!==e.cornerRadius&&"symbol"!=typeof e.cornerRadius||"fills"in e&&e.fills&&"symbol"!=typeof e.fills&&e.fills.some((e=>"SOLID"===e.type))||"strokes"in e&&e.strokes&&"symbol"!=typeof e.strokes&&e.strokes.some((e=>"SOLID"===e.type)))&&n.nodesWithoutVariables++}}),(e=>{var t;return!("INSTANCE"!==e.type||!(null===(t=e.mainComponent)||void 0===t?void 0:t.remote))}));for(const e of o)"detached"===e.type?(n.detachedComponents++,n.libraryComponents--):e.type.startsWith("modified")&&(i.has("modified-"+e.node.id)||(i.add("modified-"+e.node.id),n.modifiedComponents++));n.libraryComponents+n.localComponents+n.detachedComponents>0&&(n.componentCoverage=n.libraryComponents/(n.libraryComponents+n.localComponents+n.detachedComponents)*100),n.nodesWithStyles+n.nodesWithoutStyles>0&&(n.styleCoverage=n.nodesWithStyles/(n.nodesWithStyles+n.nodesWithoutStyles)*100),n.nodesWithVariables+n.nodesWithoutVariables>0&&(n.variableCoverage=n.nodesWithVariables/(n.nodesWithVariables+n.nodesWithoutVariables)*100);const s=n.libraryComponents+n.localComponents+n.detachedComponents+n.nodesWithStyles+n.nodesWithoutStyles+n.nodesWithVariables+n.nodesWithoutVariables,r=n.libraryComponents+n.nodesWithStyles+n.nodesWithVariables;return s>0&&(n.overallCoverage=r/s*100),n}(o,f);if((null==e?void 0:e.visualize)&&function(e,t,o){const n=figma.currentPage.findAll((e=>"RECTANGLE"===e.type&&e.name.startsWith("[Issue]")));for(const e of n)e.remove();const i=figma.createFrame();i.name="Design System Issues",i.fills=[],i.locked=!0,i.expanded=!1;for(const t of e){const e=figma.getNodeById(t.node.id);if(e){const o=s(e,t.message,{r:1,g:0,b:0});i.appendChild(o)}}for(const e of t){const t=figma.getNodeById(e.node.id);if(t){const o=s(t,e.message,{r:1,g:.6,b:0});i.appendChild(o)}}for(const e of o){const t=figma.getNodeById(e.node.id);if(t){const o=s(t,e.message,{r:1,g:.8,b:0});i.appendChild(o)}}0===i.children.length&&i.remove()}(f,h,c),(null==e?void 0:e.generateReport)&&o.length>0){let e=o[0];if("parent"in e&&e.parent&&"FRAME"===e.parent.type)e=e.parent;else if("FRAME"!==e.type){const t=figma.createFrame();t.name="Design System Report Frame",t.resize(600,400),e=t}!function(e,t){const o=figma.createFrame();o.name="Design System Coverage Report",o.resize(320,400),o.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],o.cornerRadius=8,o.x=t.x+t.width+40,o.y=t.y;const n=figma.createFrame();n.name="Header",n.resize(320,60),n.fills=[{type:"SOLID",color:{r:.9,g:.9,b:.9}}],n.x=0,n.y=0,o.appendChild(n);const i=figma.createText();i.characters="Design System Coverage",i.fontSize=18,i.x=16,i.y=16,i.fontName={family:"Inter",style:"Medium"},n.appendChild(i);const s=figma.createFrame();s.name="Overall Coverage",s.resize(288,80),s.fills=[{type:"SOLID",color:{r:.95,g:.95,b:.95}}],s.cornerRadius=4,s.x=16,s.y=76,o.appendChild(s);const r=figma.createText();r.characters="Overall Coverage",r.fontSize=14,r.x=16,r.y=16,r.fontName={family:"Inter",style:"Medium"},s.appendChild(r);const a=figma.createText();a.characters=`${e.overallCoverage.toFixed(1)}%`,a.fontSize=24,a.x=16,a.y=40,a.fontName={family:"Inter",style:"Bold"},e.overallCoverage<50?a.fills=[{type:"SOLID",color:{r:.9,g:.3,b:.3}}]:e.overallCoverage<80?a.fills=[{type:"SOLID",color:{r:1,g:.6,b:.1}}]:a.fills=[{type:"SOLID",color:{r:.3,g:.7,b:.3}}],s.appendChild(a);const l=figma.createFrame();l.name="Metrics",l.resize(288,228),l.fills=[],l.layoutMode="VERTICAL",l.primaryAxisSizingMode="AUTO",l.counterAxisSizingMode="FIXED",l.itemSpacing=8,l.x=16,l.y=172,o.appendChild(l),y(l,"Component Coverage",`${e.componentCoverage.toFixed(1)}%`,m(e.componentCoverage)),y(l,"Library Components",e.libraryComponents.toString(),{r:0,g:0,b:0}),y(l,"Local Components",e.localComponents.toString(),{r:0,g:0,b:0}),y(l,"Modified Components",e.modifiedComponents.toString(),{r:0,g:0,b:0}),y(l,"Style Coverage",`${e.styleCoverage.toFixed(1)}%`,m(e.styleCoverage)),y(l,"Variable Coverage",`${e.variableCoverage.toFixed(1)}%`,m(e.variableCoverage)),y(l,"Total Nodes",e.totalNodes.toString(),{r:0,g:0,b:0})}(b,e)}figma.ui.postMessage({type:"checkResults",payload:{componentResults:f,styleResults:h,tokenResults:c,metrics:b,libraries:r}}),figma.notify("Design system check complete!")}catch(e){console.error("Error during design system check:",e),figma.notify("Error running design system check",{error:!0})}}))}function v(t,n,i,s,y){if(!e(t))return;if("INSTANCE"===t.type){const e=function(e){const t=[];if("INSTANCE"!==e.type)return t;const o=e;return o.mainComponent?(o.mainComponent.remote||t.push({node:o,type:"nonLibrary",message:"Component is not from team library",details:`Using local component: ${o.mainComponent.name}`,mainComponent:o.mainComponent}),function(e,t){var o;if(e.overrides&&e.overrides.length>0){e.overrides.map((e=>e.overriddenFields.join(", ")));const o=e.overrides.filter((e=>e.overriddenFields.includes("characters")||e.overriddenFields.includes("textStyleId")||e.overriddenFields.includes("fontName")||e.overriddenFields.includes("fontSize")||e.overriddenFields.includes("letterSpacing")||e.overriddenFields.includes("lineHeight")||e.overriddenFields.includes("textCase"))),n=e.overrides.filter((e=>e.overriddenFields.includes("fillStyleId")||e.overriddenFields.includes("strokeStyleId")||e.overriddenFields.includes("effectStyleId"))),i=e.overrides.filter((e=>e.overriddenFields.includes("width")||e.overriddenFields.includes("height")||e.overriddenFields.includes("constrainProportions"))),s=e.overrides.filter((e=>e.overriddenFields.includes("itemSpacing")||e.overriddenFields.includes("paddingLeft")||e.overriddenFields.includes("paddingRight")||e.overriddenFields.includes("paddingTop")||e.overriddenFields.includes("paddingBottom")||e.overriddenFields.includes("layoutMode")||e.overriddenFields.includes("primaryAxisAlignItems")||e.overriddenFields.includes("counterAxisAlignItems")));o.length>0&&t.push({node:e,type:"modified-text",message:"Component text properties have been modified",details:`Modified text properties on ${o.length} layer(s)`,mainComponent:e.mainComponent}),n.length>0&&t.push({node:e,type:"modified-style",message:"Component styles have been modified",details:`Modified styles on ${n.length} layer(s)`,mainComponent:e.mainComponent}),i.length>0&&t.push({node:e,type:"modified-size",message:"Component size has been modified",details:`Size changes on ${i.length} layer(s)`,mainComponent:e.mainComponent}),s.length>0&&t.push({node:e,type:"modified-layout",message:"Component layout has been modified",details:`Layout changes on ${s.length} layer(s)`,mainComponent:e.mainComponent});const r=e.overrides.filter((e=>!(o.includes(e)||n.includes(e)||i.includes(e)||s.includes(e))));r.length>0&&t.push({node:e,type:"modified-other",message:"Component has other modifications",details:`Other modifications on ${r.length} layer(s)`,mainComponent:e.mainComponent})}if(e.componentProperties){const n=[];for(const[t,i]of Object.entries(e.componentProperties)){if("VARIANT"===i.type)continue;const s=null===(o=e.mainComponent)||void 0===o?void 0:o.componentPropertyDefinitions[t];s&&i.value!==s.defaultValue&&n.push(t)}n.length>0&&t.push({node:e,type:"modified-properties",message:"Component properties have been changed",details:`Changed properties: ${n.join(", ")}`,mainComponent:e.mainComponent})}}(o,t),t):(t.push({node:o,type:"detached",message:"Instance has been detached from main component",details:"This component is no longer linked to its main component"}),t)}(t);n.push(...e)}const m=function(e){const t=[];if(!("fills"in e)||!e.fills)return t;if("symbol"==typeof e.fills)return t;if("fillStyleId"in e&&!e.fillStyleId){const n=e.fills;if(0===n.length||!n.some((e=>!1!==e.visible)))return t;for(const i of n)if(!1!==i.visible)if("SOLID"===i.type){const n=o(Object.assign(Object.assign({},i.color),{a:1})),s=r(i);t.push({node:e,type:"fill",message:"Missing fill style",value:n,suggestions:s})}else i.type.includes("GRADIENT")&&t.push({node:e,type:"fill",message:"Missing gradient fill style",value:`Gradient (${i.type})`})}return t}(t),p=function(e){const t=[];if(!("strokes"in e)||!e.strokes)return t;if("symbol"==typeof e.strokes)return t;if("strokeStyleId"in e&&!e.strokeStyleId){const n=e.strokes;if(0===n.length||!n.some((e=>!1!==e.visible)))return t;for(const i of n)if(!1!==i.visible&&"SOLID"===i.type){const n=o(Object.assign(Object.assign({},i.color),{a:1})),s=r(i);t.push({node:e,type:"stroke",message:"Missing stroke style",value:n,suggestions:s})}}return t}(t),u=function(e){const t=[];if("TEXT"!==e.type)return t;if(!e.textStyleId){const o=`${"symbol"==typeof e.fontName?"Mixed fonts":`${e.fontName.family} ${e.fontName.style}`}, ${"symbol"==typeof e.fontSize?"Mixed sizes":`${e.fontSize}px`}`,n=function(e){const t=[];if("symbol"==typeof e.fontName||"symbol"==typeof e.fontSize)return t;const o=figma.getLocalTextStyles();for(const n of o)n.fontName.family===e.fontName.family&&n.fontName.style===e.fontName.style&&n.fontSize===e.fontSize&&t.push({name:n.name,id:n.id,value:`${n.fontName.family} ${n.fontName.style}, ${n.fontSize}px`,source:"Local"});return t}(e);t.push({node:e,type:"text",message:"Missing text style",value:o,suggestions:n})}return t}(t),g=function(e){const t=[];return"effects"in e&&e.effects?("symbol"==typeof e.effects||"effectStyleId"in e&&!e.effectStyleId&&function(e,t,o){if(0===t.length)return;const n=t.map((e=>"DROP_SHADOW"===e.type?"Drop Shadow":"INNER_SHADOW"===e.type?"Inner Shadow":"LAYER_BLUR"===e.type?"Layer Blur":"BACKGROUND_BLUR"===e.type?"Background Blur":e.type)).join(", "),i=function(e){const t=[],o=figma.getLocalEffectStyles();for(const n of o){const o=[...n.effects];a(e,o)&&t.push({name:n.name,id:n.id,value:l(o),source:"Local"})}return t}(t);o.push({node:e,type:"effect",message:"Missing effect style",value:n,suggestions:i})}(e,[...e.effects],t),t):t}(t);i.push(...m,...p,...u,...g);const h=function(e,t){const o=[];if(!("boundVariables"in e)||!e.boundVariables)return o;const n=["fills","strokes","effects","layoutGrids","opacity","cornerRadius","topLeftRadius","topRightRadius","bottomLeftRadius","bottomRightRadius","paddingLeft","paddingRight","paddingTop","paddingBottom","itemSpacing","counterAxisSpacing","strokeWeight","strokeTopWeight","strokeRightWeight","strokeBottomWeight","strokeLeftWeight"];for(const i of n){const n=e.boundVariables;if(i in n)if(Array.isArray(n[i]))for(const s of n[i])d(e,i,s.id,t,o);else d(e,i,n[i].id,t,o)}return o}(t,y),b=function(e,t){var n,i;const s=[];if("fills"in e&&e.fills&&"symbol"!=typeof e.fills){const i=e.fills;if(!(!("fillStyleId"in e)||e.fillStyleId||"boundVariables"in e&&(null===(n=e.boundVariables)||void 0===n?void 0:n.fills)))for(const n of i)if(!1!==n.visible&&"SOLID"===n.type){const i=c(n.color,t.colorTokens);if(i.length>0){const t=o(Object.assign(Object.assign({},n.color),{a:1}));s.push({node:e,type:"missingVariable",message:"Color should use a variable token",value:t,suggestions:i})}}}if("strokes"in e&&e.strokes&&"symbol"!=typeof e.strokes){const n=e.strokes;if(!(!("strokeStyleId"in e)||e.strokeStyleId||"boundVariables"in e&&(null===(i=e.boundVariables)||void 0===i?void 0:i.strokes)))for(const i of n)if(!1!==i.visible&&"SOLID"===i.type){const n=c(i.color,t.colorTokens);if(n.length>0){const t=o(Object.assign(Object.assign({},i.color),{a:1}));s.push({node:e,type:"missingVariable",message:"Stroke color should use a variable token",value:t,suggestions:n})}}}if("cornerRadius"in e&&e.cornerRadius&&"symbol"!=typeof e.cornerRadius)if("boundVariables"in e&&e.boundVariables){if(!e.boundVariables.cornerRadius){const o=f(e.cornerRadius,t.borderRadiusTokens);o.length>0&&s.push({node:e,type:"missingVariable",message:"Border radius should use a variable token",value:e.cornerRadius.toString(),suggestions:o})}}else{const o=f(e.cornerRadius,t.borderRadiusTokens);o.length>0&&s.push({node:e,type:"missingVariable",message:"Border radius should use a variable token",value:e.cornerRadius.toString(),suggestions:o})}return s}(t,y);if(s.push(...h,...b),"children"in t)for(const e of t.children)v(e,n,i,s,y)}figma.showUI(__html__,{width:500,height:600}),figma.ui.onmessage=e=>h(void 0,void 0,void 0,(function*(){var t,o;if("checkDesignSystem"===e.type)figma.notify("Analyzing design system usage...",{timeout:1e4}),yield b(null===(t=e.payload)||void 0===t?void 0:t.options);else if("highlightNode"===e.type){const t=e.payload.nodeId,o=figma.getNodeById(t);o&&(figma.currentPage.selection=[o],figma.viewport.scrollAndZoomIntoView([o]))}else"applyFix"===e.type?(yield function(e){return h(this,void 0,void 0,(function*(){try{const t=figma.getNodeById(e.nodeId);if(!t)return void figma.notify("Node not found",{error:!0});"style"===e.type?yield function(e,t){return h(this,void 0,void 0,(function*(){if("Local"!==t.style.source)try{const o=yield figma.importStyleByKeyAsync(t.style.key);"fill"===t.styleType&&"fillStyleId"in e?e.fillStyleId=o.id:"stroke"===t.styleType&&"strokeStyleId"in e?e.strokeStyleId=o.id:"effect"===t.styleType&&"effectStyleId"in e?e.effectStyleId=o.id:"text"===t.styleType&&"TEXT"===e.type&&(e.textStyleId=o.id)}catch(e){throw console.error("Error importing style:",e),new Error("Failed to import style from library")}else"fill"===t.styleType&&"fillStyleId"in e?e.fillStyleId=t.style.id:"stroke"===t.styleType&&"strokeStyleId"in e?e.strokeStyleId=t.style.id:"effect"===t.styleType&&"effectStyleId"in e?e.effectStyleId=t.style.id:"text"===t.styleType&&"TEXT"===e.type&&(e.textStyleId=t.style.id)}))}(t,e):"variable"===e.type?yield function(e,t){return h(this,void 0,void 0,(function*(){const o=figma.variables.getVariableById(t.variable.id);if(!o)throw new Error("Variable not found");switch(t.property){case"fills":"fills"in e&&e.setBoundVariable("fills",0,o);break;case"strokes":"strokes"in e&&e.setBoundVariable("strokes",0,o);break;case"cornerRadius":"cornerRadius"in e&&e.setBoundVariable("cornerRadius",o);break;case"topLeftRadius":case"topRightRadius":case"bottomLeftRadius":case"bottomRightRadius":t.property in e&&e.setBoundVariable(t.property,o);break;default:throw new Error(`Unsupported property: ${t.property}`)}}))}(t,e):"component"===e.type&&(yield function(e,t){return h(this,void 0,void 0,(function*(){if("INSTANCE"!==e.type)throw new Error("Node is not an instance");if("reset"===t.fixType)e.resetOverrides();else if("swap"===t.fixType)try{const o=(yield figma.importComponentByKeyAsync(t.componentKey)).createInstance();if(o.x=e.x,o.y=e.y,o.resize(e.width,e.height),e.parent){const t=e.parent.children.indexOf(e);e.parent.insertChild(t,o)}e.remove()}catch(e){throw console.error("Error swapping component:",e),new Error("Failed to swap component")}}))}(t,e)),figma.notify("Fix applied successfully!")}catch(e){console.error("Error applying fix:",e),figma.notify("Error applying fix",{error:!0})}}))}(e.payload.fix),yield b()):"exportReport"===e.type?(o=e.payload.metrics,figma.ui.postMessage({type:"exportReportData",payload:JSON.stringify(o,null,2)})):"close"===e.type&&figma.closePlugin()})),function(){h(this,void 0,void 0,(function*(){"check-design-system"===figma.command?yield b({visualize:!0}):"configure-settings"===figma.command||(yield b())}))}()})();